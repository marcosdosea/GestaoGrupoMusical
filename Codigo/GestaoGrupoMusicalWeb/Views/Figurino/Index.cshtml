@model IEnumerable<GestaoGrupoMusicalWeb.Models.FigurinoViewModel>

@{
    ViewData["Title"] = "Figurinos";
}

<link href="~/lib/datatable/css/datatables.min.css" rel="stylesheet" />
<partial name="_Notificar" />

<div class="d-flex justify-content-between align-items-center">
    <h5>@ViewData["Title"]</h5>
    <a class="btn btn-secondary m-3" asp-action="Create">Novo Figurino</a>
</div>

<div class="table-responsive-md">
    <table id="tableFigurino" class="table table-striped table-bordered dt-responsive nowrap">
        <thead>
            <tr class="bg-danger bg-opacity-75 text-white">
                <th class="px-3">@Html.DisplayNameFor(model => model.Id)</th>
                <th class="px-3">@Html.DisplayNameFor(model => model.Nome)</th>
                <th class="px-3">@Html.DisplayNameFor(model => model.Data)</th>
                <th class="px-3">Ações</th>
            </tr>
        </thead>
    </table>
</div>

@section Scripts {
    <script src="~/lib/datatable/js/datatables.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#tableFigurino').DataTable({
                processing: true,
                serverSide: true,
                filter: true,
                orderMulti: false,
                pageLength: 5,
                lengthMenu: [[5, 10, 20], [5, 10, 20]],
                ajax: {
                    url: "/Figurino/GetDataPage",
                    type: "POST",
                    datatype: "json"
                },
                columnDefs: [
                    {
                        targets: [0],
                        visible: true,
                        searchable: false
                    },
                    {
                        targets: [3],
                        visible: true,
                        searchable: false,
                        orderable: false
                    }
                ],
                columns: [
                    { data: "id", name: "Código", autoWidth: true },
                    { data: "nome", name: "Nome", autoWidth: true },
                    {
                        data: "data",
                        name: "Data",
                        autoWidth: true,
                        render: function (data, type) {
                            if (!data) return "";

                            const date = new Date(data);

                            const dia = String(date.getDate()).padStart(2, '0');
                            const mes = String(date.getMonth() + 1).padStart(2, '0');
                            const ano = date.getFullYear();

                            return `${dia}/${mes}/${ano}`;
                        }
                    },
                    {
                        data: null,
                        render: function (data, type, full) {
                            return '<a class="btn btn-secondary btn-sm m-2" href="/Figurino/Edit/' + full.id + '">' +
                                       '<i class="fa-solid fa-pen-to-square"></i> Editar</a>' +
                                   '<a onclick="showConfirmationModal(' + full.id + ')" class="btn btn-secondary btn-sm m-2">' +
                                       '<i class="fa-solid fa-xmark"></i> Excluir</a>' +
                                   '<a class="btn btn-secondary btn-sm m-2" href="/Figurino/Estoque/' + full.id + '">' +
                                       '<i class="fa-solid fa-arrow-right-arrow-left"></i> Estoque</a>' +
                                   '<a class="btn btn-secondary btn-sm m-2" href="/Figurino/Movimentar/' + full.id + '">' +
                                       '<i class="fa-solid fa-arrow-right-arrow-left"></i> Movimentar</a>';
                        }
                    }
                ],
                language: {
                    url: "lib/datatable/js/pt-br.json"
                }
            });
        });
    </script>
}

<div class="modal fade" id="FigurinoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Exclusão do Figurino</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Deseja <b>Excluir</b> o <b>Figurino</b>?
            </div>
            <form method="post" class="modal-footer">
                <button type="button" class="btn btn-outline-secondary col-3 me-4" data-bs-dismiss="modal">Não</button>
                <button type="submit" class="btn btn-secondary col-3">Sim</button>
            </form>
        </div>
    </div>
</div>

<script>
    function showConfirmationModal(id) {
        const modalEl = document.getElementById('FigurinoModal');
        const form = modalEl.querySelector('form');
        form.action = '/Figurino/Delete/' + id;

        const modal = new bootstrap.Modal(modalEl);
        modal.show();
    }
</script>
